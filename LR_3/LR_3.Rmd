---
title: "LR_3"
author: "Zubareva Marina"
date: '13 ноября 2017 г '
output: html_document
---

### Задачи для лабораторной: 
* работа с текстом;
* использование регулярных выражений для извлечения данных;
* переписывание существующего кода;
* ассиметричные распределения.

### Требования к оформлению
* Оформить решение в R Markdown. 
* Сохранить файл в свой репозиторий.
* Выгрузить R Markdown в HTML, назвать своим именем и отправить по почте (если хочется сдать раньше или нужна помощь).

### Исходные данные
Файл _forbes.htm_ содержит список богатейших американцев по версии журнала Форбс.
На его примере потренируемся в разборе html страниц.

#### Задание 1
1. Используйте команду ``readLines`` для загрузки файла в текстовый вектор _html_.

```{r}
 forbesD <- readLines("https://raw.githubusercontent.com/SergeyMirvoda/MD-DA-2017/master/data/forbes.htm")
```
   1) Сколько строк в файле?
```{r}
   length(forbesD) # 1991
```
   2) Сколько символов в файле?
```{r}
  sum(nchar(forbesD)) # 80380
```
  
2. Откройте файл в текстовом редакторе. Найдите строки, содержащие данные о Билле Гейтсе и Ларри Эллисоне и запомните размер их дохода.

Доход Билла Гейтса: 72$

Доход Ларри Эллисона: 41$

3. Напишите шаблон регулярного выражения и используйте функцию ``grep``, чтобы извлечь размер дохода из данных в векторе _html_.
Удостоверьтесь, что полученный вектор номеров строк содержит содержит ровно 100 записей и ссылается на номера строк в котрых действительно есть
информация о доходе, а не просто первый попавшийся текст.
```{r}
pattern <- "[$]\\d{,2}[,]?\\d{,2}?\\s[B]"
forbes.profit <- grep(pattern, forbesD)
length(forbes.profit) == 100
print("Строки со сведениями о доходе:")
forbesD[forbes.profit] # видно, что выводится 100 записей с доходами
```

4. Напишите код, использовав регулярное выражение из п. 3, и функции ``regexp`` и ``regmatches``, чтобы извлечь все данные о доходе.
Проверьте следующее:
```{r}
forbes.allprofit <- regmatches(forbesD, regexpr(pattern, forbesD)) #создание вектора доходов
```
   1) Должно быть ровно сто значений.
```{r}
length(forbes.allprofit); #ровно 100 значений
```   
   2) Самый большой доход должен быть доход Билла Гейтса
```{r}
forbes.allprofit[1];
```   
   3) Такой доход должен быть в списке один раз.
```{r}
length(forbes.allprofit[forbes.allprofit=="$72 B"]) #доход, как у Билла Гейтса, встречается только 1 раз
```   
   4) В всписке должна быть цифра, которую мы запомнили для Ларри Эллисона.
```{r}
forbes.allprofit[forbes.allprofit=="$41 B"] # вывод дохода Ларри Эллисона
```   
   5) Должно быть как минимум два значения, встречающихся несколько раз.
```{r}
length(unique(forbes.allprofit)); #66 элементов из 100 являются уникальными
``` 

#### Задание 2
5. В данных доход представлен в формате **"$42 B"**, что означает **42 × 10^9**.
Преобразуйте этот формат в числовой и сохраните в вектор _worths_. Удостоверьтесь в следующем:
   1. _worths_ является вектором и в нём сто занчений типа _double_.
   2. Все элементы вектора _worths_ больше 1 миллиарда.
   3. Самое большое число это доход Билла Гейтса.
6. Используйте вектор _worths_ , чтобы выяснить следующее:
   1. Какова медиана ста этих записей?
   2. Средний доход?
   3. Как много людей из этого списка имеют доход больше 5млрд., 10, 25? 
   1. Какой их общий доход?
   2. Какую долю от общего дохода, составляет пятёрка самых богатых.
   3. Какую долю от общего дохода, составляют 20 самых богатых.
   4. В данных [федерального резерва США](https://www.federalreserve.gov/releases/z1/current/z1.pdf) найдите
   показатель дохода всех домохозяйств (Household net worth) в соответвующем году, какую долю
   общего дохода составляют 100 богатейших людей. 
